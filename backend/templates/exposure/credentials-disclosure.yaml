id: credentials-disclosure
name: Credentials and Secrets Disclosure
version: 1.0
author: Sy3Omda
severity: medium
description: >
  Detects exposed credentials, API keys, tokens, and secrets in web
  application responses. Searches for patterns matching known secret
  key naming conventions from various services including AWS, GitHub,
  Stripe, Twilio, Firebase, Docker, database credentials, and many more.

tags:
  - credentials
  - secrets
  - exposure
  - api-keys

references:
  - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/01-Information_Gathering/05-Review_Webpage_Content_for_Information_Leakage

requests:
  - method: GET
    path:
      - "/"
      - "/config.js"
      - "/app.js"
      - "/env"
      - "/.env"
      - "/config"
      - "/settings"
      - "/api/config"
      - "/static/js/main.js"
      - "/static/js/app.js"
      - "/bundle.js"

    matchers:
      - type: regex
        regex:
          # AWS
          - "aws[_-]?(secret[_-]?access[_-]?key|access[_-]?key[_-]?id|secret[_-]?key|secret|key|access)(\\s*[=:]\\s*['\"]?[A-Za-z0-9/+=]{20,})"
          - "AKIA[0-9A-Z]{16}"
          # GitHub
          - "github[_-]?(token|oauth[_-]?token|api[_-]?key|access[_-]?token|password|secret)(\\s*[=:])"
          - "gh[ps]_[A-Za-z0-9_]{36,}"
          # Stripe
          - "sk_live_[a-zA-Z0-9]{24,}"
          - "rk_live_[a-zA-Z0-9]{24,}"
          # Google
          - "AIza[0-9A-Za-z_-]{35}"
          # Twilio
          - "twilio[_-]?(token|sid|api[_-]?key|api[_-]?secret)(\\s*[=:])"
          # Firebase
          - "firebase[_-]?(token|key|api[_-]?token|api[_-]?json)(\\s*[=:])"
          # Database
          - "(mysql|postgres|postgresql|mongodb|redis|database)[_-]?(password|pass|pwd|user|username|host)(\\s*[=:])"
          - "jdbc:(mysql|postgresql|oracle|sqlserver)://"
          # Docker / Heroku
          - "docker[_-]?(password|token|pass|key)(\\s*[=:])"
          - "heroku[_-]?(api[_-]?key|token)(\\s*[=:])"
          # JWT / Auth
          - "jwt[_-]?secret(\\s*[=:])"
          - "auth[_-]?token(\\s*[=:])"
          - "secret[_-]?key[_-]?base(\\s*[=:])"
          # NPM / PyPI
          - "npm[_-]?(token|auth[_-]?token|api[_-]?key)(\\s*[=:])"
          # Slack
          - "xox[baprs]-[0-9a-zA-Z-]+"
          # SendGrid / Mailgun
          - "sendgrid[_-]?(api[_-]?key|password|key)(\\s*[=:])"
          - "mailgun[_-]?(api[_-]?key|secret)(\\s*[=:])"
          # Private keys
          - "-----BEGIN (RSA |DSA |EC |OPENSSH )?PRIVATE KEY-----"
          # Generic patterns
          - "(api[_-]?key|apikey|api[_-]?secret|secret[_-]?key|access[_-]?token|auth[_-]?token|private[_-]?key)(\\s*[=:]\\s*['\"]?[A-Za-z0-9/+=_-]{16,})"
        condition: or

    extractors:
      - type: regex
        name: aws_keys
        regex:
          - "(AKIA[0-9A-Z]{16})"
        group: 1

      - type: regex
        name: stripe_keys
        regex:
          - "(sk_live_[a-zA-Z0-9]{24,})"
        group: 1

      - type: regex
        name: google_keys
        regex:
          - "(AIza[0-9A-Za-z_-]{35})"
        group: 1

      - type: regex
        name: slack_tokens
        regex:
          - "(xox[baprs]-[0-9a-zA-Z-]+)"
        group: 1

      - type: regex
        name: github_tokens
        regex:
          - "(gh[ps]_[A-Za-z0-9_]{36,})"
        group: 1
